# =============================================================================
# Gwenn Agent Configuration
# Copy this to .env and fill in your values
# =============================================================================

# --- Claude API ---
# Option A: Anthropic API key (paid API plan)
# ANTHROPIC_API_KEY=  # leave unset to use Claude Code OAuth credentials

# Option B: Claude Code OAuth token (Claude Pro/Max via `claude` CLI)
# Leave ANTHROPIC_API_KEY unset to auto-detect from ~/.claude/.credentials.json
# Or set explicitly:
# ANTHROPIC_AUTH_TOKEN=sk-ant-oat01-your-oauth-token
# CLAUDE_CODE_OAUTH_TOKEN=sk-ant-oat01-your-oauth-token
#
# Notes:
# - If both ANTHROPIC_API_KEY and OAuth token are set, Gwenn uses ANTHROPIC_API_KEY.
# - Claude Code OAuth uses https://api.anthropic.com plus anthropic-beta: oauth-2025-04-20.
# - If you set ANTHROPIC_BASE_URL, ensure that header is forwarded.

# Code default (if unset): claude-sonnet-4-5-20250929
GWENN_MODEL=claude-opus-4-6
# GWENN_MODEL=claude-sonnet-4-6
# GWENN_MODEL=claude-haiku-4-5
GWENN_MAX_TOKENS=8192
GWENN_THINKING_BUDGET=16000
# Thinking effort: low | medium | high | max (controls reasoning depth in adaptive mode)
GWENN_THINKING_EFFORT=high
GWENN_REQUEST_TIMEOUT_SECONDS=120.0
GWENN_RETRY_MAX_RETRIES=3
GWENN_RETRY_BASE_DELAY=0.5
GWENN_RETRY_MAX_DELAY=8.0
GWENN_RETRY_EXPONENTIAL_BASE=2.0
GWENN_RETRY_JITTER_RANGE=0.25

# --- Logging ---
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
GWENN_LOG_LEVEL=WARNING

# --- Skills ---
# Directory containing skill .md files (auto-created if missing)
# GWENN_SKILLS_DIR=./gwenn_skills

# --- Memory Persistence ---
GWENN_DATA_DIR=./gwenn_data
GWENN_EPISODIC_DB=./gwenn_data/episodic.db
## Vector store directory (ChromaDB). Only used when GWENN_RETRIEVAL_MODE is
## "embedding" or "hybrid"; ignored in the default "keyword" mode.
GWENN_SEMANTIC_DB=./gwenn_data/semantic_vectors
GWENN_RETRIEVAL_MODE=keyword
GWENN_EMBEDDING_TOP_K=25
GWENN_HYBRID_KEYWORD_WEIGHT=0.5
GWENN_HYBRID_EMBEDDING_WEIGHT=0.5
# 0 disables recent episode preload (unconsolidated episodes still load)
GWENN_STARTUP_EPISODE_LIMIT=5000
GWENN_SHUTDOWN_PERSIST_RECENT_EPISODES=0
# Persist semantic graph after each consolidation pass
GWENN_PERSIST_SEMANTIC_AFTER_CONSOLIDATION=True
GWENN_WM_EVICTION_TO_EPISODIC=True

# --- Memory Consolidation Tuning ---
# Seconds between consolidation eligibility checks
# GWENN_CONSOLIDATION_INTERVAL=600.0
# Maximum episodes per consolidation batch
# GWENN_CONSOLIDATION_MAX_EPISODES=200
# Retrieval scoring weights for consolidation (must sum to ~1.0)
# GWENN_CONSOLIDATION_RECENCY_DECAY=0.995
# GWENN_CONSOLIDATION_IMPORTANCE_WEIGHT=0.4
# GWENN_CONSOLIDATION_RECENCY_WEIGHT=0.3
# GWENN_CONSOLIDATION_RELEVANCE_WEIGHT=0.3

# --- Heartbeat (sec)---
GWENN_HEARTBEAT_INTERVAL=30.0
GWENN_HEARTBEAT_MIN_INTERVAL=5.0
GWENN_HEARTBEAT_MAX_INTERVAL=120.0
# Share significant autonomous thoughts with channel owners (true/false).
GWENN_PROACTIVE_MESSAGES=false
# Circuit breaker — opens after consecutive failures to prevent rapid-fire errors
# GWENN_HEARTBEAT_CIRCUIT_MAX_CONSECUTIVE=10
# GWENN_HEARTBEAT_CIRCUIT_BASE_SECONDS=60.0
# GWENN_HEARTBEAT_CIRCUIT_MAX_SECONDS=900.0

# Checkpoint/Restore — periodic cognitive state snapshots for crash recovery
GWENN_CHECKPOINT_ENABLED=true
# GWENN_CHECKPOINT_INTERVAL_BEATS=50
# GWENN_CHECKPOINT_MAX_COUNT=10

# --- Affect ---
GWENN_AROUSAL_CEILING=0.92
GWENN_DISTRESS_THRESHOLD=0.80
GWENN_DISTRESS_DURATION_LIMIT=300
# Emotional momentum — how quickly feelings carry forward each heartbeat (0-1)
# GWENN_AFFECT_MOMENTUM_DECAY=0.85
# How strongly emotions pull toward baseline each heartbeat (0-1)
# GWENN_AFFECT_BASELINE_PULL=0.05

# --- Context Window ---
GWENN_CONTEXT_LIMIT=180000
GWENN_COMPACTION_TRIGGER=0.85
GWENN_WORKING_MEMORY_SLOTS=7
# Max messages in conversation history before trimming
# GWENN_MAX_CONVERSATION_MESSAGES=400

# --- Safety ---
GWENN_MAX_TOOL_ITERATIONS=150
GWENN_REQUIRE_APPROVAL_FOR=["file_write","shell_exec","run_command","web_request"]
GWENN_SANDBOX_ENABLED=True
# Tool default policy: "deny" blocks unknown/non-builtin tools, "allow" permits them
# GWENN_TOOL_DEFAULT_POLICY=deny
# Explicit allowlist (only effective when GWENN_TOOL_DEFAULT_POLICY=deny)
# GWENN_ALLOWED_TOOLS=[]
# Explicit denylist (overrides allowlist)
# GWENN_DENIED_TOOLS=[]
GWENN_MAX_INPUT_TOKENS=0
GWENN_MAX_OUTPUT_TOKENS=0
GWENN_MAX_API_CALLS=0
GWENN_MAX_MODEL_CALLS_PER_SECOND=0
GWENN_MAX_MODEL_CALLS_PER_MINUTE=0
# How long to wait for a human to approve/deny a tool call (seconds)
# GWENN_APPROVAL_TIMEOUT=120.0
# Tool executor defaults
# GWENN_TOOL_DEFAULT_TIMEOUT=30.0
# GWENN_TOOL_MAX_OUTPUT_LENGTH=25000

# --- Privacy ---
GWENN_REDACTION_ENABLED=False
GWENN_REDACT_BEFORE_API=False
GWENN_REDACT_BEFORE_PERSIST=False
GWENN_REDACTION_DISABLED_CATEGORIES=

# --- Sensory Grounding (Layer 11) ---
GWENN_MAX_PERCEPTS_PER_CHANNEL=10
GWENN_PERCEPT_EXPIRY=300.0

# --- Ethical Reasoning (Layer 12) ---
GWENN_ETHICS_HISTORY_SIZE=100
GWENN_ETHICS_CONCERN_THRESHOLD=0.3

# --- Inter-Agent Communication (Layer 13) ---
GWENN_AGENT_ID=gwenn
GWENN_INTERAGENT_BUFFER_SIZE=100

# --- Goal System ---
# Multiplier for intrinsic need decay rate (1.0 = default speed)
# GWENN_GOAL_DECAY_MULTIPLIER=1.0
# Default amount of progress per goal advance call
# GWENN_GOAL_ADVANCE_AMOUNT=0.35
# Maximum completed goals to keep in history
# GWENN_MAX_COMPLETED_GOALS=200

# --- Inner Life ---
# Seconds before an unused thinking mode gets a variety boost
# GWENN_VARIETY_PRESSURE_SECONDS=300.0
# Maximum variety boost multiplier
# GWENN_VARIETY_BOOST_MAX=2.0

# --- Metacognition ---
# Maximum confidence-calibration records retained
# GWENN_MAX_CALIBRATION_RECORDS=1000
# Maximum honesty-audit records retained
# GWENN_MAX_AUDIT_RECORDS=500
# Maximum active metacognitive concerns
# GWENN_MAX_CONCERNS=20
# Maximum metacognitive insights carried forward
# GWENN_MAX_INSIGHTS=20

# --- Theory of Mind ---
# Days before unconfirmed beliefs start decaying
# GWENN_BELIEF_STALENESS_DAYS=30.0
# Maximum topics tracked per user model
# GWENN_MAX_TOPICS_PER_USER=50
# Maximum user models before LRU eviction
# GWENN_MAX_USER_MODELS=500

# --- Orchestration (Subagent System) ---
GWENN_ORCHESTRATION_ENABLED=True
GWENN_MAX_CONCURRENT_SUBAGENTS=5
GWENN_SUBAGENT_TIMEOUT=120.0
GWENN_SUBAGENT_MAX_ITERATIONS=50
GWENN_SUBAGENT_MAX_DEPTH=3
# Empty = use parent model
# GWENN_SUBAGENT_MODEL=
GWENN_MAX_SUBAGENT_API_CALLS=100
GWENN_MAX_ACTIVE_SWARMS=3
GWENN_MAX_CONCURRENT_API_CALLS=3
# Default tools given to subagents (comma-separated)
# GWENN_SUBAGENT_DEFAULT_TOOLS=
# Runtime: in_process (default) | docker
GWENN_SUBAGENT_RUNTIME=in_process
# Docker container settings
GWENN_SUBAGENT_DOCKER_IMAGE=gwenn-subagent:latest
GWENN_SUBAGENT_DOCKER_NETWORK=none
GWENN_SUBAGENT_DOCKER_MEMORY=256m
GWENN_SUBAGENT_DOCKER_CPU=0.5
# Autonomous spawning (heartbeat-driven)
GWENN_AUTONOMOUS_SPAWN_ENABLED=True
GWENN_AUTONOMOUS_SPAWN_COOLDOWN=300.0
GWENN_AUTONOMOUS_SPAWN_MAX_HOURLY=10

# --- MCP ---
GWENN_MCP_SERVERS=[]

# --- Groq Whisper Transcription (optional, free tier) ---
# Get API key from https://console.groq.com
# GROQ_API_KEY=gsk_your_key_here
# GWENN_WHISPER_MODEL=whisper-large-v3-turbo
# GWENN_GROQ_MAX_AUDIO_BYTES=26214400

# =============================================================================
# Channel Configuration — enable/disable each channel independently
# =============================================================================
CLI_ENABLED=true
TELEGRAM_ENABLED=false
DISCORD_ENABLED=false
SLACK_ENABLED=false

# --- Telegram (required if TELEGRAM_ENABLED=true) ---
# Obtain from @BotFather → /newbot
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
# User IDs to whitelist ([] = public, no restriction).
# Accepts: bare value (123), comma-separated (123,456), or JSON array (["123","456"]).
TELEGRAM_ALLOWED_USER_IDS=[]
# Owner user IDs — controls /setup and receives proactive messages.
# Falls back to TELEGRAM_ALLOWED_USER_IDS if empty.
TELEGRAM_OWNER_USER_IDS=[]
TELEGRAM_MAX_HISTORY_LENGTH=50
# Session TTL in seconds (default 3600 = 1 hour).
# TELEGRAM_SESSION_TTL=3600.0
# Session scope: per_user | per_chat | per_thread (forum topics).
# TELEGRAM_SESSION_SCOPE=per_thread
# Max concurrent update processing (0 = sequential, 64 recommended).
# TELEGRAM_CONCURRENT_UPDATES=64
# Per-user lock cache size (bounds memory for concurrent access).
# TELEGRAM_USER_LOCK_CACHE_SIZE=512
# Enable photo/document/voice handling (requires Claude vision for images).
# TELEGRAM_ENABLE_MEDIA=false
# Auto-install python-telegram-bot on first Telegram startup if missing.
# Set to false to disable runtime dependency bootstrap.
# GWENN_AUTO_INSTALL_TELEGRAM=true

# --- Discord (required if DISCORD_ENABLED=true) ---
# Obtain from Discord Developer Portal → Bot → Token
# Required intents: Message Content (enable in portal)
DISCORD_BOT_TOKEN=your_discord_bot_token_here
# Guild IDs to restrict to ([] = all guilds allowed).
# Accepts: bare value (111), comma-separated (111,222), or JSON array (["111","222"]).
DISCORD_ALLOWED_GUILD_IDS=[]
# User IDs to whitelist ([] = all users allowed).
# DISCORD_ALLOWED_USER_IDS=[]
# Owner user IDs — controls /setup and receives proactive messages.
# DISCORD_OWNER_USER_IDS=[]
# Allow direct messages (disabled by default).
# DISCORD_ALLOW_DMS=false
DISCORD_MAX_HISTORY_LENGTH=50
DISCORD_SESSION_TTL=3600.0
# Session scope: per_user | per_chat | per_thread (threads/forums).
# DISCORD_SESSION_SCOPE=per_thread
# Per-user lock cache size (bounds memory for concurrent access).
# DISCORD_USER_LOCK_CACHE_SIZE=512
# Set to a guild ID for instant slash-command sync during development
DISCORD_SYNC_GUILD_ID=
# Enable image attachment downloading (requires Claude vision).
# DISCORD_ENABLE_MEDIA=false

# --- Slack (required if SLACK_ENABLED=true) ---
# Uses Socket Mode — requires both bot token (xoxb-) and app-level token (xapp-)
# The app-level token must have the `connections:write` scope.
GWENN_SLACK_BOT_TOKEN=xoxb-your-bot-token
GWENN_SLACK_APP_TOKEN=xapp-your-app-token
# User IDs to whitelist ([] = all users allowed).
# GWENN_SLACK_ALLOWED_USER_IDS=[]
# Owner user IDs — receives proactive messages.
# GWENN_SLACK_OWNER_USER_IDS=[]
# GWENN_SLACK_MAX_HISTORY_LENGTH=50
# GWENN_SLACK_SESSION_TTL=3600.0
# Session scope: per_user | per_chat | per_thread
# GWENN_SLACK_SESSION_SCOPE=per_thread
# GWENN_SLACK_USER_LOCK_CACHE_SIZE=512

# =============================================================================
# Daemon — Persistent Background Process
# =============================================================================
# Unix socket for CLI ↔ daemon communication
GWENN_DAEMON_SOCKET=./gwenn_data/gwenn.sock
GWENN_DAEMON_PID_FILE=./gwenn_data/gwenn.pid
# Optional shared token for daemon request authentication (recommended)
GWENN_DAEMON_AUTH_TOKEN=
# Channel flags above (CLI_ENABLED, TELEGRAM_ENABLED, DISCORD_ENABLED, SLACK_ENABLED)
# also control which channels the daemon manages.
GWENN_DAEMON_MAX_CONNECTIONS=10
GWENN_DAEMON_CONNECTION_TIMEOUT=300.0

# Session store (automatic conversation history for /resume)
GWENN_DAEMON_SESSIONS_DIR=./gwenn_data/sessions
GWENN_DAEMON_SESSION_MAX_COUNT=20
GWENN_DAEMON_SESSION_MAX_MESSAGES=200
# Show user-message previews in /resume listings (off by default to reduce data exposure)
GWENN_DAEMON_SESSION_INCLUDE_PREVIEW=False
# Redact PII-like patterns before persisting session transcripts
GWENN_DAEMON_REDACT_SESSION_CONTENT=True

# --- Gateway (WebSocket + HTTP server) ---
# Enable the aiohttp-based gateway (CLI and future clients connect here)
GWENN_GATEWAY_ENABLED=true
GWENN_GATEWAY_HOST=127.0.0.1
GWENN_GATEWAY_PORT=18900
# Keep the legacy Unix socket alongside the gateway
GWENN_LEGACY_SOCKET_ENABLED=true
# MCP Streamable HTTP / SSE server (stub — not yet implemented)
GWENN_MCP_SERVER_ENABLED=false
# A2A Agent Card endpoint (stub — not yet implemented)
GWENN_A2A_ENABLED=false
# Feature flag: heartbeat-as-core architecture (Phase 1)
GWENN_HEARTBEAT_CORE=true
